<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Portfolio - Noa Capital</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg: #0E1117; --card: #1E1E1E; --text: #E0E0E0; --gray: #9CA3AF; --green: #22C55E; --red: #EF4444; --blue: #3B82F6; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 250px; background: #161B22; padding: 20px; display: flex; flex-direction: column; border-right: 1px solid #30363D; }
        .logo { font-size: 22px; font-weight: 800; margin-bottom: 40px; color: white; display:flex; align-items:center; gap:10px; }
        .nav-btn { padding: 12px; margin: 5px 0; cursor: pointer; border-radius: 6px; color: var(--gray); font-weight: 500; transition: 0.2s; }
        .nav-btn:hover, .nav-btn.active { background: #21262D; color: white; }
        .nav-btn.active { border-left: 3px solid var(--blue); }

        /* Main Content */
        .main { flex: 1; padding: 40px; overflow-y: auto; }
        .section { display: none; animation: fadeIn 0.4s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* KPI Grid */
        .grid-kpi { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--card); padding: 20px; border-radius: 8px; border: 1px solid #30363D; }
        .kpi-title { font-size: 13px; color: var(--gray); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
        .kpi-val { font-size: 28px; font-weight: 700; color: white; }
        .green { color: var(--green); } .red { color: var(--red); }

        /* Table */
        .table-container { background: var(--card); border-radius: 8px; border: 1px solid #30363D; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { text-align: left; padding: 15px; background: #21262D; color: var(--gray); font-weight: 600; font-size: 12px; }
        td { padding: 15px; border-bottom: 1px solid #30363D; color: #E0E0E0; }
        tr:last-child td { border-bottom: none; }
        
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 700; }
        .bg-buy { background: rgba(34, 197, 94, 0.15); color: var(--green); }
        .bg-hold { background: rgba(234, 179, 8, 0.15); color: #EAB308; }

        /* Convictions */
        .conviction-item { border-left: 3px solid var(--blue); background: var(--card); padding: 20px; margin-bottom: 15px; border-radius: 4px; }

        /* Inputs */
        input { background: #0D1117; border: 1px solid #30363D; color: white; padding: 12px; border-radius: 6px; width: 100%; margin-top: 5px; box-sizing: border-box; }
        button { background: var(--blue); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 20px; width: 100%; }
        button:hover { background: #2563EB; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo">ü¶Ö Noa Capital</div>
    <div class="nav-btn active" onclick="show('portfolio', this)">üèÜ Portefeuille</div>
    <div class="nav-btn" onclick="show('convictions', this)">üìú Convictions</div>
    <div class="nav-btn" onclick="show('simulation', this)">üîÆ Simulation</div>
    
    <div style="margin-top:auto; padding-top:20px; border-top:1px solid #30363D;">
        <div style="font-size:11px; color:#555;">Status API: <span id="apiStatus" style="color:orange">‚óè Connexion...</span></div>
    </div>
</div>

<div class="main">

    <div id="portfolio" class="section active">
        <div style="margin-bottom:30px">
            <h1 style="margin:0">Vue d'Ensemble</h1>
            <p style="color:var(--gray); margin:5px 0 0 0">Performance temps r√©el.</p>
        </div>
        
        <div class="grid-kpi">
            <div class="card">
                <div class="kpi-title">Valeur Totale</div>
                <div class="kpi-val" id="totalVal">-- ‚Ç¨</div>
            </div>
            <div class="card">
                <div class="kpi-title">Plus-Value</div>
                <div class="kpi-val" id="totalPv">-- ‚Ç¨</div>
            </div>
            <div class="card">
                <div class="kpi-title">Dividendes (Est.)</div>
                <div class="kpi-val" id="totalDiv">-- ‚Ç¨</div>
            </div>
             <div class="card">
                <div class="kpi-title">Performance</div>
                <div class="kpi-val" id="totalPerf">-- %</div>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>SOCI√âT√â</th>
                        <th>PRIX ACHAT</th>
                        <th>COURS ACTUEL</th>
                        <th>VALORISATION</th>
                        <th>PERF %</th>
                        <th>AVIS</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <div class="grid-kpi" style="margin-top:30px; grid-template-columns: 1fr 1fr; height: 350px;">
            <div class="card">
                <div class="kpi-title">R√©partition Sectorielle</div>
                <div style="height:250px; position:relative;"><canvas id="chartSecteur"></canvas></div>
            </div>
            <div class="card">
                <div class="kpi-title">Top Performance</div>
                <div style="height:250px; position:relative;"><canvas id="chartPerf"></canvas></div>
            </div>
        </div>
    </div>

    <div id="convictions" class="section">
        <h1>Journal de Convictions</h1>
        <div class="conviction-item" style="border-color: #22C55E; background: rgba(34, 197, 94, 0.05);">
            <h3 style="color:#22C55E; margin-top:0">üß† Th√®se Macro : Le Pari du R√©el</h3>
            <p style="color:#ccc">Je suis fondamentalement <b>Contrarien</b>. J'√©vite la bulle Tech US pour miser sur la "Old Economy" indispensable (Industrie, √ânergie, Mat√©riaux). C'est le retour √† la valeur tangible.</p>
        </div>
        <div id="convictionsList"></div>
    </div>

    <div id="simulation" class="section">
        <h1>Projection Patrimoniale</h1>
        <div class="grid-kpi" style="grid-template-columns: 1fr 2fr;">
            <div class="card">
                <label>√âpargne mensuelle (‚Ç¨)</label>
                <input type="number" id="simMonthly" value="500">
                <label style="display:block; margin-top:15px">Dur√©e (Ann√©es)</label>
                <input type="number" id="simYears" value="20">
                <label style="display:block; margin-top:15px">Rendement annuel (%)</label>
                <input type="number" id="simRate" value="8">
                <button onclick="calcSim()">Calculer la Rente</button>
            </div>
            <div class="card">
                <div style="height:100%; min-height:300px;"><canvas id="chartSim"></canvas></div>
            </div>
        </div>
        <div style="margin-top:20px; text-align:center;">
             <div style="color:var(--gray); text-transform:uppercase; font-size:12px;">Patrimoine Final Estim√©</div>
             <div style="font-size:48px; font-weight:800; color:var(--blue);" id="simResult">-- ‚Ç¨</div>
        </div>
    </div>

</div>

<script>
    // --- TA CL√â API ---
    const API_KEY = "d546sr9r01qlj84b84r0d546sr9r01qlj84b84rg"; 

    // Donn√©es initiales (Fixes pour d√©marrage instantan√©)
    let portfolio = [
        { tick: "AI.PA", name: "Air Liquide", sec: "Chimie", q: 20, pru: 171.18, price: 166.40, div: 0.019, avis: "ACHETER", these: "Le bunker du portefeuille. Visibilit√© 15 ans." },
        { tick: "SU.PA", name: "Schneider Electric", sec: "Industrie", q: 10, pru: 236.99, price: 242.80, div: 0.015, avis: "ACHETER", these: "Leader mondial de l'√©lectrification." },
        { tick: "TTE.PA", name: "TotalEnergies", sec: "Energie", q: 38, pru: 56.97, price: 58.95, div: 0.052, avis: "ACHETER", these: "Cash machine sous-valoris√©e." },
        { tick: "AIR.PA", name: "Airbus", sec: "A√©ro.", q: 5, pru: 212.46, price: 145.20, div: 0.012, avis: "CONSERVER", these: "Duopole avec carnet de commande plein." },
        { tick: "SGO.PA", name: "Saint-Gobain", sec: "Construction", q: 7, pru: 88.15, price: 83.50, div: 0.026, avis: "CONSERVER", these: "R√©novation √©nerg√©tique et efficacit√©." },
        { tick: "BRES.PA", name: "ETF Basic Res.", sec: "Mat√©riaux", q: 6, pru: 104.84, price: 108.10, div: 0.0, avis: "-", these: "Protection contre l'inflation." }
    ];

    // Variables graphiques
    let chart1, chart2, chart3;

    // --- FONCTIONS ---

    async function fetchPrices() {
        const status = document.getElementById('apiStatus');
        
        // On v√©rifie chaque action
        for (let stock of portfolio) {
            // L'ETF BRES.PA bug souvent sur les API gratuites, on l'ignore pour la mise √† jour dynamique
            if(stock.tick.includes("BRES")) continue;

            try {
                // Appel API
                const res = await fetch(`https://finnhub.io/api/v1/quote?symbol=${stock.tick}&token=${API_KEY}`);
                const data = await res.json();
                
                // 'c' est le prix actuel (Current Price)
                if (data.c && data.c > 0) {
                    stock.price = data.c; // Mise √† jour du prix
                }
            } catch (e) {
                console.log("Erreur sur " + stock.tick);
            }
        }
        
        status.innerHTML = "‚óè En Ligne (Prix √† jour)";
        status.style.color = "#22C55E";
        
        // On redessine tout avec les nouveaux prix
        renderDashboard();
    }

    function renderDashboard() {
        let totalV = 0, totalI = 0, totalD = 0;
        const tbody = document.getElementById('tableBody');
        const convList = document.getElementById('convictionsList');
        
        tbody.innerHTML = '';
        convList.innerHTML = '';

        const sectors = {};
        const labels = [], perfs = [], colors = [];

        portfolio.forEach(d => {
            const val = d.price * d.q;
            const invest = d.pru * d.q;
            const perf = ((d.price - d.pru) / d.pru) * 100;
            
            totalV += val; totalI += invest; totalD += val * d.div;

            // Tableau
            tbody.innerHTML += `<tr>
                <td><b>${d.name}</b> <br><span style="color:#555; font-size:10px">${d.tick}</span></td>
                <td>${d.pru.toFixed(2)} ‚Ç¨</td>
                <td style="color:#3B82F6; font-weight:700">${d.price.toFixed(2)} ‚Ç¨</td>
                <td>${Math.round(val).toLocaleString()} ‚Ç¨</td>
                <td class="${perf >= 0 ? 'green' : 'red'}">${perf > 0 ? '+' : ''}${perf.toFixed(1)}%</td>
                <td><span class="badge ${d.avis === 'ACHETER' ? 'bg-buy' : 'bg-hold'}">${d.avis}</span></td>
            </tr>`;

            // Convictions
            convList.innerHTML += `<div class="conviction-item">
                <div style="display:flex; justify-content:space-between; align-items:center">
                    <strong>${d.name}</strong>
                    <span class="badge bg-buy" style="background:#21262D; color:#888">${d.sec}</span>
                </div>
                <p style="color:#AAA; margin:10px 0 0 0; font-size:14px;">${d.these}</p>
            </div>`;

            // Data Charts
            labels.push(d.tick);
            perfs.push(perf);
            colors.push(perf >= 0 ? '#22C55E' : '#EF4444');
            sectors[d.sec] = (sectors[d.sec] || 0) + val;
        });

        // KPI Updates
        document.getElementById('totalVal').innerText = Math.round(totalV).toLocaleString() + " ‚Ç¨";
        const pv = totalV - totalI;
        const totalPerf = (pv / totalI) * 100;
        
        const pvEl = document.getElementById('totalPv');
        pvEl.innerText = (pv > 0 ? '+' : '') + Math.round(pv).toLocaleString() + " ‚Ç¨";
        pvEl.className = "kpi-val " + (pv >= 0 ? 'green' : 'red');

        document.getElementById('totalDiv').innerText = Math.round(totalD) + " ‚Ç¨";
        
        const perfEl = document.getElementById('totalPerf');
        perfEl.innerText = (totalPerf > 0 ? '+' : '') + totalPerf.toFixed(2) + " %";
        perfEl.className = "kpi-val " + (totalPerf >= 0 ? 'green' : 'red');

        // Charts Logic
        if(chart1) chart1.destroy();
        if(chart2) chart2.destroy();

        const ctx1 = document.getElementById('chartSecteur').getContext('2d');
        chart1 = new Chart(ctx1, {
            type: 'doughnut',
            data: {
                labels: Object.keys(sectors),
                datasets: [{ data: Object.values(sectors), backgroundColor: ['#3B82F6','#8B5CF6','#EC4899','#10B981','#F59E0B', '#6366F1'], borderWidth:0 }]
            },
            options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'right', labels:{color:'#999', boxWidth:10}}} }
        });

        const ctx2 = document.getElementById('chartPerf').getContext('2d');
        chart2 = new Chart(ctx2, {
            type: 'bar',
            data: { labels: labels, datasets: [{ data: perfs, backgroundColor: colors, borderRadius:4 }] },
            options: { 
                responsive:true, maintainAspectRatio:false, indexAxis: 'y',
                plugins:{ legend:{display:false} },
                scales:{ x:{ticks:{color:'#666'}, grid:{color:'#333'}}, y:{ticks:{color:'#DDD'}} }
            }
        });
    }

    // Simulation
    function calcSim() {
        const m = Number(document.getElementById('simMonthly').value);
        const y = Number(document.getElementById('simYears').value);
        const r = Number(document.getElementById('simRate').value) / 100;
        
        let capital = 10000;
        const points = []; const labs = [];

        for(let i=0; i<=y; i++) {
            points.push(capital);
            labs.push("An " + i);
            capital = (capital + (m*12)) * (1+r);
        }

        document.getElementById('simResult').innerText = Math.round(points[points.length-1]).toLocaleString() + " ‚Ç¨";

        if(chart3) chart3.destroy();
        chart3 = new Chart(document.getElementById('chartSim'), {
            type: 'line',
            data: { 
                labels: labs, 
                datasets: [{ label: 'Patrimoine', data: points, borderColor: '#3B82F6', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill:true, tension:0.4 }] 
            },
            options: { responsive:true, maintainAspectRatio:false, scales:{ x:{ticks:{color:'#666'}}, y:{ticks:{color:'#666'}, grid:{color:'#333'}} } }
        });
    }

    // Navigation
    function show(id, btn) {
        document.querySelectorAll('.section').forEach(e => e.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
        btn.classList.add('active');
        if(id === 'simulation') calcSim();
    }

    // INIT
    renderDashboard(); // 1. Affiche tout de suite les donn√©es fixes
    fetchPrices();     // 2. Va chercher les vrais prix en arri√®re-plan
    calcSim();         // 3. Init la simu

</script>
</body>
</html>
