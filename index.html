<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Mon Portefeuille - Noa Capital</title>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.31.0/build/stlite.js"></script>
  </head>
  <body>
    <div id="root" style="height: 100vh"></div>

    <script>
      stlite.mount({
        requirements: ["plotly", "pandas"], // On charge les librairies Python ici
        entrypoint: "streamlit_app.py",
        files: {
          "streamlit_app.py": `
import streamlit as st
import pandas as pd
import plotly.express as px

# --- CONFIGURATION STREAMLIT ---
st.set_page_config(page_title="Mon Portefeuille", page_icon="üèÜ", layout="wide")
st.title("üèÜ Mon Portefeuille R√©el")

# --- DONN√âES SNAPSHOT (Pour vitesse MAX sans serveur) ---
# On simule les donn√©es pour que l'affichage soit INSTANTAN√â
data = [
    {"Ticker": "AI.PA",  "Soci√©t√©": "Air Liquide",        "Secteur": "Chimie",     "Qt√©": 20, "PRU": 171.18, "Cours": 166.40, "Avis": "ACHETER"},
    {"Ticker": "SU.PA",  "Soci√©t√©": "Schneider Electric", "Secteur": "Tech/Indus", "Qt√©": 10, "PRU": 236.99, "Cours": 242.80, "Avis": "ACHETER"},
    {"Ticker": "TTE.PA", "Soci√©t√©": "TotalEnergies",      "Secteur": "Energie",    "Qt√©": 38, "PRU": 56.97,  "Cours": 58.95,  "Avis": "ACHETER"},
    {"Ticker": "AIR.PA", "Soci√©t√©": "Airbus",             "Secteur": "A√©ro.",      "Qt√©": 5,  "PRU": 212.46, "Cours": 145.20, "Avis": "CONSERVER"},
    {"Ticker": "SGO.PA", "Soci√©t√©": "Saint-Gobain",       "Secteur": "Construct.", "Qt√©": 7,  "PRU": 88.15,  "Cours": 83.50,  "Avis": "CONSERVER"},
    {"Ticker": "BRES.PA","Soci√©t√©": "ETF Basic Res.",     "Secteur": "Mat√©riaux",  "Qt√©": 6,  "PRU": 104.84, "Cours": 108.10, "Avis": "-"},
]

df = pd.DataFrame(data)

# Calculs
df["Valo"] = df["Cours"] * df["Qt√©"]
df["+/- Value"] = (df["Cours"] - df["PRU"]) * df["Qt√©"]
df["Perf %"] = ((df["Cours"] - df["PRU"]) / df["PRU"]) * 100

# --- KPI ---
total_invest = df["Valo"].sum()
total_pv = df["+/- Value"].sum()

st.divider()
c1, c2, c3 = st.columns(3)
c1.metric("üí∞ Valeur Totale", f"{total_invest:,.2f} ‚Ç¨")
c2.metric("Plus-Value Latente", f"{total_pv:+,.2f} ‚Ç¨")
c3.metric("Performance Globale", f"{(total_pv/(total_invest-total_pv))*100:.2f} %")
st.divider()

# --- TABLEAU ---
st.subheader("üìä Tableau de Bord")
st.dataframe(
    df,
    column_config={
        "Ticker": st.column_config.TextColumn("Ticker", width="small"),
        "Soci√©t√©": st.column_config.TextColumn("Soci√©t√©", width="medium"),
        "Cours": st.column_config.NumberColumn("Cours", format="%.2f ‚Ç¨"),
        "Valo": st.column_config.NumberColumn("Valo", format="%.0f ‚Ç¨"),
        "Perf %": st.column_config.NumberColumn("Perf", format="%.2f %%"),
        "+/- Value": st.column_config.NumberColumn("+/-", format="%+.2f ‚Ç¨"),
    },
    hide_index=True,
    use_container_width=True
)

# --- GRAPHIQUES ---
col1, col2 = st.columns(2)
with col1:
    fig = px.pie(df, values='Valo', names='Secteur', title='Par Secteur', hole=0.4)
    st.plotly_chart(fig, use_container_width=True)
with col2:
    df_s = df.sort_values("Perf %", ascending=False)
    fig = px.bar(df_s, x="Ticker", y="Perf %", title='Performance', color="Perf %", 
                 color_continuous_scale=["#FF4B4B", "#21C354"])
    st.plotly_chart(fig, use_container_width=True)

st.caption("Propuls√© par Stlite (Python in Browser) - Noa Capital")
`
        }
      },
      document.getElementById("root")
      );
    </script>
  </body>
</html>
