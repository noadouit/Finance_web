<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noa Capital | v1.2.1</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { 
                        dark: '#050505', 
                        panel: '#0f1115',
                        surface: '#181b21',
                        accent: '#3b82f6', 
                        success: '#10b981', 
                        danger: '#ef4444', 
                        gold: '#fbbf24',
                        subtle: '#27272a'
                    },
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'Menlo', 'monospace'] 
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                        'hero-glow': 'conic-gradient(from 180deg at 50% 50%, #2a8af6 0deg, #a853ba 180deg, #e92a67 360deg)',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: #e4e4e7; overflow-x: hidden; }
        
        /* Background Grid Pattern */
        .bg-grid {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
        }

        .tab-content { display: none; width: 100%; animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        .tab-content.active { display: block; }
        
        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(20px) scale(0.98); } 
            to { opacity: 1; transform: translateY(0) scale(1); } 
        }
        
        #home.active { display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: calc(100vh - 80px); }
        
        .glass-panel {
            background: rgba(24, 27, 33, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .search-input-wrapper:focus-within {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5), 0 0 40px rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }
        
        .loader { border: 2px solid rgba(255,255,255,0.1); border-top: 2px solid #3b82f6; border-radius: 50%; width: 20px; height: 20px; animation: spin 0.8s linear infinite; display:none; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .flash-update { animation: flash 0.6s ease-out; background-color: rgba(16, 185, 129, 0.15) !important; }
        @keyframes flash { 0% { background-color: rgba(16, 185, 129, 0.3); } 100% { background-color: transparent; } }

        /* Login Specifics */
        .login-glow {
            position: absolute; width: 600px; height: 600px; background: radial-gradient(circle, rgba(59,130,246,0.15) 0%, rgba(0,0,0,0) 70%);
            top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: -1; pointer-events: none;
        }
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>

<body class="antialiased min-h-screen flex flex-col selection:bg-blue-500/30 selection:text-blue-200">

    <div id="login-screen" class="fixed inset-0 z-[9999] bg-dark flex flex-col justify-center items-center overflow-hidden">
        <div class="absolute inset-0 bg-grid opacity-40"></div>
        <div class="login-glow"></div>
        
        <div class="relative z-10 flex flex-col items-center gap-6 animate-in fade-in duration-700 zoom-in-95">
            <div class="relative group">
                <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl blur opacity-40 group-hover:opacity-75 transition duration-1000 group-hover:duration-200"></div>
                <div class="relative bg-panel border border-white/10 w-20 h-20 rounded-2xl flex items-center justify-center">
                    <span class="font-bold text-4xl text-transparent bg-clip-text bg-gradient-to-br from-white to-gray-500">N</span>
                </div>
            </div>
            
            <div class="text-center">
                <h1 class="text-4xl font-bold tracking-tight text-white mb-2">Noa Capital</h1>
                <div class="flex items-center justify-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    <p class="text-gray-500 font-mono text-xs tracking-widest uppercase">System v1.2.1 ‚Ä¢ Restricted</p>
                </div>
            </div>
        </div>
        
        <div class="login-box w-full max-w-sm p-8 mt-8 glass-panel rounded-2xl shadow-2xl relative z-10 transition-all duration-300">
            <div class="mb-6">
                <label class="block text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-2 ml-1">Access Key</label>
                <div class="relative group">
                    <input type="password" id="passwordInput" 
                        class="w-full bg-black/40 border border-white/10 text-white text-center tracking-[0.5em] rounded-xl p-4 focus:border-blue-500 focus:ring-1 focus:ring-blue-500/50 outline-none transition font-mono placeholder-gray-700" 
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                        onkeypress="if(event.key === 'Enter') checkLogin()">
                </div>
                <p id="loginError" class="text-red-400 text-xs mt-3 text-center hidden font-medium flex items-center justify-center gap-2"><span class="block w-1 h-1 bg-red-500 rounded-full"></span> Invalid credentials</p>
            </div>
            <button onclick="checkLogin()" class="w-full bg-white text-black hover:bg-gray-200 font-bold py-3.5 rounded-xl transition shadow-[0_0_20px_rgba(255,255,255,0.1)] hover:shadow-[0_0_30px_rgba(255,255,255,0.2)]">
                Initialize Session
            </button>
        </div>
        
        <div class="absolute bottom-8 text-gray-700 text-[10px] font-mono">
            NC-PROTOCOL SECURIZED CONNECTION
        </div>
    </div>

    <div id="app-container" style="display: none;" class="flex-1 flex flex-col w-full h-full relative">
        <div class="fixed inset-0 bg-grid opacity-20 pointer-events-none z-0"></div>

        <nav class="glass-panel sticky top-4 z-50 h-16 mx-4 mt-4 rounded-2xl border border-white/5 shadow-lg">
            <div class="h-full flex items-center justify-between px-6">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="switchTab('home')">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center text-white font-bold shadow-lg shadow-blue-900/30 group-hover:scale-105 transition">N</div>
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-white leading-none">Noa Capital</span>
                        <span class="text-[9px] text-gray-500 font-mono leading-none mt-1">v1.2.1</span>
                    </div>
                </div>
                
                <div class="flex items-center gap-4">
                    <div id="status-badge" class="hidden md:flex items-center gap-2 bg-black/40 px-3 py-1.5 rounded-full border border-white/5">
                        <span class="relative flex h-2 w-2">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500" id="status-dot"></span>
                        </span>
                        <span class="text-[10px] font-bold text-gray-300 uppercase tracking-wider" id="status-text">Live</span>
                    </div>

                    <div class="flex space-x-1 bg-black/40 p-1 rounded-xl border border-white/5 backdrop-blur-md">
                        <button onclick="switchTab('home')" id="btn-home" class="px-4 py-1.5 text-xs font-medium rounded-lg transition-all duration-300">Recherche</button>
                        <button onclick="switchTab('convictions')" id="btn-convictions" class="px-4 py-1.5 text-xs font-medium rounded-lg text-gray-400 hover:text-white transition-all duration-300">Th√®se</button>
                        <button onclick="switchTab('dashboard')" id="btn-dashboard" class="px-4 py-1.5 text-xs font-medium rounded-lg text-gray-400 hover:text-white transition-all duration-300">Portefeuille</button>
                        <button onclick="switchTab('watchlist')" id="btn-watchlist" class="px-4 py-1.5 text-xs font-medium rounded-lg text-gray-400 hover:text-white transition-all duration-300">Watchlist</button>
                        <button onclick="switchTab('simulation')" id="btn-simulation" class="px-4 py-1.5 text-xs font-medium rounded-lg text-gray-400 hover:text-white transition-all duration-300">Simulateur</button>
                    </div>
                </div>
            </div>
        </nav>

        <main class="flex-1 w-full relative z-10">

            <div id="home" class="tab-content active">
                <div class="text-center mb-10 px-4 pt-10 animate-in fade-in slide-in-from-bottom-4 duration-1000">
                    <div class="inline-block mb-4 px-3 py-1 rounded-full border border-blue-500/20 bg-blue-500/5 text-blue-400 text-xs font-mono">Market Intelligence v1.2.1</div>
                    <h1 class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-b from-white to-gray-500 mb-6 tracking-tight">Market Insight.</h1>
                    <p class="text-gray-400 max-w-lg mx-auto text-sm leading-relaxed">Plateforme d'analyse fondamentale et technique pour la gestion d'actifs r√©els et strat√©giques.</p>
                </div>
                
                <div class="w-full max-w-2xl px-4 relative z-10 mb-12">
                    <div class="search-input-wrapper glass-panel rounded-2xl p-2 flex items-center transition-all duration-300 group">
                        <input type="text" id="mainTickerInput" class="w-full bg-transparent border-none text-white text-lg px-6 py-4 focus:outline-none placeholder-gray-600 font-medium tracking-wide" placeholder="Rechercher un actif (ex: AI.PA)..." onkeypress="if(event.key === 'Enter') searchTicker()">
                        <button onclick="searchTicker()" class="bg-white hover:bg-gray-200 text-black font-bold py-3 px-8 rounded-xl transition shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
                        </button>
                    </div>
                    <div class="mt-6 flex justify-center gap-4 text-xs font-mono text-gray-500">
                        <span class="text-gray-600">Trending:</span>
                        <button onclick="fillSearch('AI.PA')" class="hover:text-blue-400 transition underline decoration-dotted">Air Liquide</button>
                        <button onclick="fillSearch('MC.PA')" class="hover:text-blue-400 transition underline decoration-dotted">LVMH</button>
                        <button onclick="fillSearch('NVDA')" class="hover:text-blue-400 transition underline decoration-dotted">Nvidia</button>
                    </div>
                </div>
                
                <div id="searchLoader" class="loader mt-4"></div>
                
                <div id="resultCard" class="hidden w-full max-w-5xl px-4 pb-20">
                    <div class="glass-panel rounded-3xl overflow-hidden border border-white/10 shadow-2xl shadow-black/50">
                        <div class="p-8 border-b border-white/5 flex justify-between items-start bg-gradient-to-r from-white/5 to-transparent">
                            <div>
                                <div class="flex items-center gap-3 mb-2">
                                    <h2 class="text-4xl font-bold text-white tracking-tight" id="res-name">Nom</h2>
                                    <span class="text-[10px] px-2 py-1 rounded bg-blue-500/10 text-blue-400 border border-blue-500/20 font-mono tracking-wider" id="res-type">EQUITY</span>
                                </div>
                                <div class="text-gray-400 text-xs font-mono flex gap-3">
                                    <span id="res-symbol" class="text-white">TICKER</span>
                                    <span class="text-gray-600">|</span>
                                    <span id="res-exchange">Market</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-5xl font-mono font-bold text-white tracking-tighter" id="res-price">--</div>
                                <div class="text-lg font-bold flex items-center justify-end gap-2 mt-1" id="res-perf">-- %</div>
                            </div>
                        </div>

                        <div class="h-[400px] w-full p-6 bg-black/20 relative">
                            <canvas id="searchChart"></canvas>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 divide-x divide-white/5 border-t border-white/5 bg-black/40">
                            <div class="p-6">
                                <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-1">Ouverture</div>
                                <div class="text-lg font-mono text-white" id="res-open">--</div>
                            </div>
                            <div class="p-6">
                                <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-1">Range Jour</div>
                                <div class="text-sm font-mono text-gray-300" id="res-range">--</div>
                            </div>
                            <div class="p-6">
                                <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-1">Volume</div>
                                <div class="text-lg font-mono text-blue-300" id="res-vol">--</div>
                            </div>
                            <div class="p-6">
                                <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-1">Cap. Boursi√®re</div>
                                <div class="text-lg font-mono text-white" id="res-cap">--</div>
                            </div>

                            <div class="p-6 border-t border-white/5">
                                <div class="text-[10px] text-blue-400 uppercase font-bold tracking-wider mb-1">PER (P/E)</div>
                                <div class="text-xl font-bold text-white" id="res-pe">--</div>
                            </div>
                            <div class="p-6 border-t border-white/5">
                                <div class="text-[10px] text-blue-400 uppercase font-bold tracking-wider mb-1">BPA (EPS)</div>
                                <div class="text-xl font-bold text-white" id="res-eps">--</div>
                            </div>
                            <div class="p-6 border-t border-white/5">
                                <div class="text-[10px] text-yellow-400 uppercase font-bold tracking-wider mb-1">Analystes</div>
                                <div class="text-sm font-bold text-white mt-1" id="res-rating">--</div>
                            </div>
                            <div class="p-6 border-t border-white/5">
                                <div class="text-[10px] text-purple-400 uppercase font-bold tracking-wider mb-1">B√™ta</div>
                                <div class="text-xl font-bold text-white" id="res-beta">--</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="convictions" class="tab-content max-w-5xl mx-auto p-6 lg:p-10">
                <div class="mb-12 border-b border-white/10 pb-8">
                    <span class="text-blue-500 font-mono text-xs tracking-wider uppercase mb-2 block">Macro Strategy</span>
                    <h1 class="text-4xl md:text-5xl font-bold text-white tracking-tight mb-6">Th√®se d'Investissement.</h1>
                    <p class="text-xl text-gray-400 leading-relaxed max-w-3xl font-light">
                        Pivot structurel vers les <span class="text-white font-normal">Actifs R√©els</span>. Analyse de la transition d'une √©conomie immat√©rielle vers une √©conomie de raret√© physique.
                    </p>
                </div>

                <div class="grid gap-16">
                    <section>
                        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-4">
                            <span class="flex items-center justify-center w-8 h-8 rounded bg-red-500/10 text-red-500 text-sm font-mono border border-red-500/20">01</span> 
                            La Grande Rotation
                        </h2>
                        <div class="glass-panel p-8 rounded-2xl border-l-2 border-l-red-500/50">
                            <p class="text-gray-300 leading-relaxed text-lg mb-4">
                                Les valorisations de la Tech (Nasdaq) ont atteint des niveaux de perfection qui ne tol√®rent aucune erreur (PER > 35x). C'est un risque asym√©trique d√©favorable.
                            </p>
                            <p class="text-gray-400 leading-relaxed">
                                Nous sortons des actifs immat√©riels survaloris√©s pour nous positionner sur des actifs tangibles sous-valoris√©s. Nous pr√©f√©rons poss√©der une mine de cuivre (P/E 12) indispensable √† l'IA, plut√¥t qu'un logiciel (P/E 50).
                            </p>
                        </div>
                    </section>

                    <section>
                        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-4">
                            <span class="flex items-center justify-center w-8 h-8 rounded bg-yellow-500/10 text-yellow-500 text-sm font-mono border border-yellow-500/20">02</span> 
                            La Croissance Ricardienne
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-surface p-6 rounded-2xl border border-white/5 hover:border-yellow-500/30 transition">
                                <div class="text-3xl mb-4 grayscale hover:grayscale-0 transition">‚õèÔ∏è</div>
                                <h3 class="font-bold text-white mb-2">Raret√© Physique</h3>
                                <p class="text-sm text-gray-500 leading-relaxed">Offre in√©lastique. On ne peut pas "imprimer" du cuivre.</p>
                            </div>
                            <div class="bg-surface p-6 rounded-2xl border border-white/5 hover:border-yellow-500/30 transition">
                                <div class="text-3xl mb-4 grayscale hover:grayscale-0 transition">üè≠</div>
                                <h3 class="font-bold text-white mb-2">Pricing Power</h3>
                                <p class="text-sm text-gray-500 leading-relaxed">Capacit√© √† monter les prix sans perte de volume.</p>
                            </div>
                            <div class="bg-surface p-6 rounded-2xl border border-white/5 hover:border-yellow-500/30 transition">
                                <div class="text-3xl mb-4 grayscale hover:grayscale-0 transition">üõ°Ô∏è</div>
                                <h3 class="font-bold text-white mb-2">Moat Industriel</h3>
                                <p class="text-sm text-gray-500 leading-relaxed">Barri√®res √† l'entr√©e massives (CAPEX, Temps).</p>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-4">
                            <span class="flex items-center justify-center w-8 h-8 rounded bg-blue-500/10 text-blue-500 text-sm font-mono border border-blue-500/20">03</span> 
                            S√©lection Tactique
                        </h2>
                        <div class="space-y-4">
                            <div class="glass-panel p-6 rounded-xl border border-white/5 hover:border-blue-500/40 transition duration-300 group">
                                <div class="flex items-center justify-between mb-2">
                                    <h3 class="text-lg font-bold text-white group-hover:text-blue-400 transition">Air Liquide (AI.PA)</h3>
                                    <span class="text-[10px] font-mono border border-blue-500/30 text-blue-300 px-2 py-0.5 rounded">D√âFENSIF</span>
                                </div>
                                <p class="text-gray-400 text-sm">Contrats index√©s sur l'√©nergie. Business model anti-inflation. Leader hydrog√®ne.</p>
                            </div>
                            <div class="glass-panel p-6 rounded-xl border border-white/5 hover:border-yellow-500/40 transition duration-300 group">
                                <div class="flex items-center justify-between mb-2">
                                    <h3 class="text-lg font-bold text-white group-hover:text-gold transition">ETF Basic Resources</h3>
                                    <span class="text-[10px] font-mono border border-yellow-500/30 text-yellow-300 px-2 py-0.5 rounded">OFFENSIF</span>
                                </div>
                                <p class="text-gray-400 text-sm">Super-cycle des m√©taux. L'infrastructure IA et EV n√©cessite une quantit√© massive de cuivre.</p>
                            </div>
                            <div class="glass-panel p-6 rounded-xl border border-white/5 hover:border-red-500/40 transition duration-300 group">
                                <div class="flex items-center justify-between mb-2">
                                    <h3 class="text-lg font-bold text-white group-hover:text-red-400 transition">TotalEnergies (TTE.PA)</h3>
                                    <span class="text-[10px] font-mono border border-red-500/30 text-red-300 px-2 py-0.5 rounded">YIELD</span>
                                </div>
                                <p class="text-gray-400 text-sm">Cash-flow monstre financant la transition. Valorisation absurde (< 8x P/E).</p>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <div id="dashboard" class="tab-content max-w-7xl mx-auto p-6 lg:p-8">
                <div class="mb-8 flex flex-col md:flex-row md:justify-between md:items-end gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-white tracking-tight">Portefeuille Global</h1>
                        <div class="flex items-center gap-3 mt-2">
                            <div class="text-xs text-gray-500 font-mono flex items-center gap-2 px-3 py-1 rounded bg-white/5 border border-white/5">
                                <div class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse hidden" id="scan-progress-dot"></div>
                                <span id="last-update">En attente de flux...</span>
                            </div>
                        </div>
                    </div>
                    <div class="glass-panel px-6 py-3 rounded-2xl border border-white/10 text-right min-w-[200px]">
                        <div class="text-[10px] text-gray-400 uppercase tracking-widest font-bold mb-1">AUM Total</div>
                        <div class="text-4xl font-mono font-bold text-white tracking-tighter" id="totalVal">-- ‚Ç¨</div>
                    </div>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="glass-panel rounded-2xl p-5 border border-white/5 hover:border-white/10 transition">
                        <p class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">Plus-Value</p>
                        <p class="mt-2 text-2xl font-mono font-bold tracking-tight" id="totalPv">--</p>
                    </div>
                    <div class="glass-panel rounded-2xl p-5 border border-white/5 hover:border-white/10 transition">
                        <p class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">Dividendes (Est.)</p>
                        <p class="mt-2 text-2xl font-mono font-bold text-indigo-400 tracking-tight" id="totalDiv">--</p>
                    </div>
                    <div class="glass-panel rounded-2xl p-5 border border-white/5 hover:border-white/10 transition">
                        <p class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">P/E Moyen</p>
                        <p class="mt-2 text-2xl font-mono font-bold text-white tracking-tight" id="avgPER">--</p>
                    </div>
                    <div class="glass-panel rounded-2xl p-5 border border-white/5 hover:border-white/10 transition relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-16 h-16 bg-gradient-to-br from-green-500/20 to-transparent rounded-bl-full"></div>
                        <p class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">Top Perf</p>
                        <p class="mt-2 text-lg font-bold text-white truncate" id="topStock">--</p>
                        <p class="text-xs font-mono font-bold text-green-400" id="topStockPerf">--</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 glass-panel rounded-3xl border border-white/5 overflow-hidden flex flex-col shadow-xl">
                        <div class="px-6 py-4 border-b border-white/5 bg-white/[0.02] flex justify-between items-center">
                            <h3 class="text-xs font-bold text-white uppercase tracking-widest">Positions Actives</h3>
                            <button class="text-gray-500 hover:text-white transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" /></svg></button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm text-gray-400">
                                <thead class="bg-black/20 uppercase text-[10px] text-gray-500 font-bold tracking-wider">
                                    <tr>
                                        <th class="px-6 py-4">Soci√©t√©</th>
                                        <th class="px-6 py-4 text-right">Cours</th>
                                        <th class="px-6 py-4 text-center">Var. 24h</th>
                                        <th class="px-6 py-4 text-right hidden sm:table-cell">Valo</th>
                                        <th class="px-6 py-4 text-right">Perf.</th>
                                        <th class="px-6 py-4 text-center text-blue-400">P/E</th>
                                        <th class="px-6 py-4 text-center text-purple-400">P/S</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-white/5" id="tableBody"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="glass-panel rounded-3xl border border-white/5 p-6 flex flex-col shadow-xl">
                        <h3 class="text-xs font-bold text-white uppercase tracking-widest mb-6">Allocation Sectorielle</h3>
                        <div class="flex-1 relative min-h-[250px]"><canvas id="sectorChart"></canvas></div>
                    </div>
                </div>
            </div>

            <div id="watchlist" class="tab-content max-w-7xl mx-auto p-6 lg:p-8">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-white tracking-tight">Liste de Surveillance</h1>
                    <p class="text-gray-400 mt-2 text-sm">Opportunit√©s tactiques : Asie & Pays √âmergents.</p>
                </div>
                <div class="glass-panel rounded-3xl border border-white/5 overflow-hidden shadow-xl">
                    <div class="px-6 py-4 border-b border-white/5 bg-white/[0.02] flex justify-between items-center">
                        <h3 class="text-xs font-bold text-white uppercase tracking-widest">Cibles</h3>
                        <span id="wl-scan-status" class="text-[10px] text-blue-400 font-mono hidden animate-pulse">Scanning Live Data...</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-gray-400">
                            <thead class="bg-black/20 uppercase text-[10px] text-gray-500 font-bold tracking-wider">
                                <tr>
                                    <th class="px-6 py-4">Actif</th>
                                    <th class="px-6 py-4">Th√®se / Objectif</th>
                                    <th class="px-6 py-4 text-right">Cours Live</th>
                                    <th class="px-6 py-4 text-center">Var. 24h</th>
                                    <th class="px-6 py-4 text-right text-yellow-400">Statut</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/5" id="watchlistBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="simulation" class="tab-content max-w-7xl mx-auto p-6 lg:p-8">
                <h1 class="text-3xl font-bold text-white tracking-tight mb-8">Projection Patrimoniale</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="glass-panel border border-white/5 rounded-3xl p-8 h-fit">
                        <h3 class="font-bold text-white mb-6 uppercase text-xs tracking-widest flex items-center gap-2">
                            <span class="w-1 h-4 bg-blue-500 rounded-full"></span> Param√®tres
                        </h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-wider mb-2">Capital Initial</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-3 text-gray-500">‚Ç¨</span>
                                    <input type="number" id="sim-start" value="10000" class="w-full bg-black/30 border border-white/10 rounded-xl p-3 pl-8 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500/50 outline-none transition font-mono">
                                </div>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-wider mb-2">Apport Mensuel</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-3 text-gray-500">‚Ç¨</span>
                                    <input type="number" id="sim-monthly" value="500" class="w-full bg-black/30 border border-white/10 rounded-xl p-3 pl-8 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500/50 outline-none transition font-mono">
                                </div>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-wider mb-2">Rendement Annuel (%)</label>
                                <input type="number" id="sim-rate" value="8" class="w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500/50 outline-none transition font-mono">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-wider mb-2">Dur√©e (Ann√©es)</label>
                                <input type="number" id="sim-years" value="20" class="w-full bg-black/30 border border-white/10 rounded-xl p-3 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500/50 outline-none transition font-mono">
                            </div>
                        </div>
                        <button onclick="calculateSim()" class="w-full mt-8 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3.5 rounded-xl transition shadow-lg shadow-blue-900/20 text-sm tracking-wide">
                            ACTUALISER LA PROJECTION
                        </button>
                    </div>

                    <div class="lg:col-span-2 glass-panel border border-white/5 rounded-3xl p-8 flex flex-col shadow-xl">
                        <div class="text-center mb-8">
                            <div class="text-[10px] text-gray-500 uppercase tracking-widest font-bold">Capital Final Estim√©</div>
                            <div class="text-5xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-white to-green-400 mt-2 font-mono tracking-tighter" id="sim-result">-- ‚Ç¨</div>
                        </div>
                        <div class="flex-1 relative min-h-[350px]">
                            <canvas id="simChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div> 

    <script>
        // --- LOGIQUE DE LOGIN ---
        const PASSWORD_CONFIG = "admin"; 

        function checkLogin() {
            const input = document.getElementById('passwordInput');
            const box = document.querySelector('.login-box');
            const errorMsg = document.getElementById('loginError');

            if (input.value === PASSWORD_CONFIG) {
                // Succ√®s Animation
                document.getElementById('login-screen').style.transition = 'all 0.8s ease-in-out';
                document.getElementById('login-screen').style.opacity = '0';
                document.getElementById('login-screen').style.transform = 'scale(1.05)';
                setTimeout(() => {
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('app-container').style.display = 'flex';
                    initApp();
                }, 800);
            } else {
                // Erreur
                errorMsg.classList.remove('hidden');
                box.classList.remove('shake');
                void box.offsetWidth; 
                box.classList.add('shake');
                input.value = '';
                input.focus();
                input.classList.add('border-red-500');
                setTimeout(()=>input.classList.remove('border-red-500'), 1000);
            }
        }

        // --- DATA ---
        let portfolio = [
            { tick: "AI.PA",  name: "Air Liquide",        sec: "Chimie",     q: 20, pru: 171.18, div: 0.019, price: 0, prev: 0, eps: 5.90, sps: 53.5, beta: 0.8 },
            { tick: "SU.PA",  name: "Schneider Electric", sec: "Industrie",  q: 10, pru: 236.99, div: 0.015, price: 0, prev: 0, eps: 7.50, sps: 63.0, beta: 1.1 },
            { tick: "TTE.PA", name: "TotalEnergies",      sec: "Energie",    q: 38, pru: 56.97,  div: 0.052, price: 0, prev: 0, eps: 8.00, sps: 70.0, beta: 0.6 },
            { tick: "AIR.PA", name: "Airbus",             sec: "A√©ro.",      q: 5,  pru: 212.46, div: 0.012, price: 0, prev: 0, eps: 4.90, sps: 88.0, beta: 1.2 },
            { tick: "SGO.PA", name: "Saint-Gobain",       sec: "Construct.", q: 7,  pru: 88.15,  div: 0.026, price: 0, prev: 0, eps: 5.50, sps: 96.0, beta: 1.3 },
            { tick: "BRES.PA",name: "ETF Basic Res.",     sec: "Mat√©riaux",  q: 6,  pru: 104.84, div: 0.0,   price: 0, prev: 0, eps: 0,    sps: 0,    beta: 1.0 },
        ];

        let watchlist = [
            { tick: "CJ1.PA", name: "Amundi MSCI Japan", thesis: "Attente rebond Yen", price: 0, prev: 0 },
            { tick: "AEEM.PA", name: "Amundi MSCI Emerging", thesis: "Attente point bas cycle", price: 0, prev: 0 },
            { tick: "EURJPY=X", name: "Forex EUR/JPY", thesis: "Surveillance volatilit√©", price: 0, prev: 0 }
        ];

        // NAV
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            ['home','dashboard','watchlist','convictions','simulation'].forEach(b=>{
                const el=document.getElementById('btn-'+b);
                if(b===id){
                    el.classList.add('bg-white','text-black','shadow-lg');
                    el.classList.remove('text-gray-400','hover:text-white');
                } else {
                    el.classList.remove('bg-white','text-black','shadow-lg');
                    el.classList.add('text-gray-400','hover:text-white');
                }
            });
            if(id!=='home') document.getElementById('resultCard').classList.add('hidden');
            if(id==='simulation') calculateSim();
            if(id==='watchlist') setTimeout(startWatchlistFeed, 500); 
        }

        // API ENGINE
        async function fetchPriceRobust(ticker) {
            const proxy = "https://corsproxy.io/?";
            const url = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1d&range=1d&t=${Date.now()}`;
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 3500); 
            try {
                const response = await fetch(proxy + encodeURIComponent(url), { signal: controller.signal });
                clearTimeout(timeoutId);
                if (!response.ok) throw new Error("HTTP Error");
                const json = await response.json();
                return {
                    price: json.chart.result[0].meta.regularMarketPrice,
                    prev: json.chart.result[0].meta.chartPreviousClose,
                    meta: json.chart.result[0].meta,
                    timestamps: json.chart.result[0].timestamp,
                    quotes: json.chart.result[0].indicators.quote[0].close
                };
            } catch (e) { return null; }
        }

        async function fetchFundamentalsQuote(ticker) {
            const proxy = "https://corsproxy.io/?";
            const url = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${ticker}&t=${Date.now()}`;
            try {
                const response = await fetch(proxy + encodeURIComponent(url));
                const json = await response.json();
                return json.quoteResponse.result[0];
            } catch(e) { return null; }
        }

        // LIVE FEED PORTFOLIO
        async function startLiveFeed() {
            const dot = document.getElementById('status-dot');
            const updateTxt = document.getElementById('last-update');
            const scanDot = document.getElementById('scan-progress-dot');

            scanDot.classList.remove('hidden');
            updateTxt.innerText = "Syncing...";

            for (let i = 0; i < portfolio.length; i++) {
                const stock = portfolio[i];
                updateTxt.innerText = `Sync: ${stock.tick}`;
                
                // Visual feedback on row
                const row = document.getElementById(`row-${i}`);
                if(row) row.style.backgroundColor = "rgba(59, 130, 246, 0.05)";

                const data = await fetchPriceRobust(stock.tick);
                if (data && data.price) {
                    stock.price = data.price;
                    stock.prev = data.prev;
                    renderDashboard(i); 
                }
                
                if(row) setTimeout(()=> row.style.backgroundColor = "transparent", 400);
                await new Promise(r => setTimeout(r, 600)); // Slightly faster scan
            }

            scanDot.classList.add('hidden');
            updateTxt.innerText = "Updated just now";
            updateTxt.className = "text-xs text-gray-400 font-mono";
            renderDashboard(); 
        }

        // LIVE FEED WATCHLIST
        async function startWatchlistFeed() {
            renderWatchlist(); 
            for (let i = 0; i < watchlist.length; i++) {
                const item = watchlist[i];
                const status = document.getElementById('wl-scan-status');
                if(status) { status.classList.remove('hidden'); status.innerText = `Fetching ${item.tick}...`; }
                
                const data = await fetchPriceRobust(item.tick);
                if (data && data.price) {
                    item.price = data.price;
                    item.prev = data.prev;
                    renderWatchlist(i); 
                }
                await new Promise(r => setTimeout(r, 800));
            }
            const status = document.getElementById('wl-scan-status');
            if(status) status.classList.add('hidden');
        }

        // RENDER DASHBOARD
        function renderDashboard(highlightIndex = -1) {
            let totalVal = 0, totalInvest = 0, totalDiv = 0, totalPER = 0, countPER = 0;
            let topStock = { name: '-', perf: -999 };
            const tbody = document.getElementById('tableBody');
            if (highlightIndex === -1) tbody.innerHTML = '';

            portfolio.forEach((stock, index) => {
                const valo = stock.price * stock.q;
                const invest = stock.pru * stock.q;
                
                let perfPct = stock.pru > 0 && stock.price > 0 ? ((stock.price - stock.pru) / stock.pru) * 100 : 0;
                let dayVarPct = stock.price > 0 && stock.prev > 0 ? ((stock.price - stock.prev) / stock.prev) * 100 : 0;
                
                let calculatedPER = (stock.price > 0 && stock.eps > 0) ? stock.price / stock.eps : 0;
                let calculatedPSR = (stock.price > 0 && stock.sps > 0) ? stock.price / stock.sps : 0;

                totalVal += valo; totalInvest += invest; totalDiv += valo * stock.div;
                if(calculatedPER > 0) { totalPER += calculatedPER; countPER++; }
                if(perfPct > topStock.perf) topStock = { name: stock.name, perf: perfPct };
                
                const dPrice = stock.price > 0 ? stock.price.toFixed(2) + " ‚Ç¨" : '...';
                const dValo = stock.price > 0 ? Math.round(valo).toLocaleString() + " ‚Ç¨" : '-';
                const dPerf = stock.price > 0 ? (perfPct > 0 ? '+' : '') + perfPct.toFixed(2) + "%" : '-';
                const cPerf = perfPct >= 0 ? 'text-emerald-400' : 'text-red-400';
                const dDay = stock.price > 0 ? (dayVarPct > 0 ? '+' : '') + dayVarPct.toFixed(2) + "%" : '-';
                const cDay = dayVarPct >= 0 ? 'text-emerald-400 bg-emerald-500/10' : 'text-red-400 bg-red-500/10';
                
                const dPER = calculatedPER > 0 ? calculatedPER.toFixed(2) : '-';
                const dPSR = calculatedPSR > 0 ? calculatedPSR.toFixed(2) : '-';

                if (highlightIndex === -1) {
                    const row = `
                        <tr id="row-${index}" class="hover:bg-white/[0.03] transition duration-200">
                            <td class="px-6 py-4"><div class="font-bold text-white text-sm">${stock.name}</div><div class="text-[10px] text-gray-500 font-mono tracking-wider">${stock.tick}</div></td>
                            <td class="px-6 py-4 text-right text-white font-mono text-sm" id="price-${index}">${dPrice}</td>
                            <td class="px-6 py-4 text-center"><span class="px-2 py-1 rounded text-xs font-mono font-bold ${cDay}" id="day-${index}">${dDay}</span></td>
                            <td class="px-6 py-4 text-right font-bold text-gray-300 font-mono text-sm hidden sm:table-cell" id="valo-${index}">${dValo}</td>
                            <td class="px-6 py-4 text-right ${cPerf} font-mono font-bold text-sm" id="perf-${index}">${dPerf}</td>
                            <td class="px-6 py-4 text-center text-blue-300 font-mono text-xs" id="per-${index}">${dPER}</td>
                            <td class="px-6 py-4 text-center text-purple-400 font-mono text-xs" id="psr-${index}">${dPSR}</td>
                        </tr>`;
                    tbody.innerHTML += row;
                } else if (index === highlightIndex) {
                    const row = document.getElementById(`row-${index}`);
                    row.classList.add('flash-update'); setTimeout(() => row.classList.remove('flash-update'), 600);
                    document.getElementById(`price-${index}`).innerHTML = dPrice;
                    document.getElementById(`day-${index}`).innerHTML = dDay; document.getElementById(`day-${index}`).className = `px-2 py-1 rounded text-xs font-mono font-bold ${cDay}`;
                    document.getElementById(`valo-${index}`).innerHTML = dValo;
                    document.getElementById(`perf-${index}`).innerHTML = dPerf; document.getElementById(`perf-${index}`).className = `px-6 py-4 text-right font-mono font-bold text-sm ${cPerf}`;
                    document.getElementById(`per-${index}`).innerHTML = dPER;
                    document.getElementById(`psr-${index}`).innerHTML = dPSR;
                }
            });

            if(totalVal > 0) {
                const gpv = totalVal - totalInvest;
                document.getElementById('totalVal').innerText = Math.round(totalVal).toLocaleString() + " ‚Ç¨";
                document.getElementById('totalPv').innerText = (gpv > 0 ? '+' : '') + Math.round(gpv).toLocaleString() + " ‚Ç¨";
                document.getElementById('totalPv').className = `mt-2 text-2xl font-mono font-bold tracking-tight ${gpv >= 0 ? 'text-emerald-400' : 'text-red-400'}`;
                document.getElementById('totalDiv').innerText = Math.round(totalDiv) + " ‚Ç¨";
                document.getElementById('avgPER').innerText = countPER > 0 ? (totalPER/countPER).toFixed(1) : "-";
                document.getElementById('topStock').innerText = topStock.name;
                const topPerfEl = document.getElementById('topStockPerf');
                if(topStock.perf > -999) { topPerfEl.innerText = "+" + topStock.perf.toFixed(2) + " %"; }
            } else {
                document.getElementById('totalVal').innerText = "Loading...";
            }

            if (highlightIndex === -1 && document.getElementById('sectorChart')) {
                if(window.myChart) window.myChart.destroy();
                const initialData = [20, 15, 30, 10, 10, 15]; 
                
                window.myChart = new Chart(document.getElementById('sectorChart').getContext('2d'), { 
                    type: 'doughnut', 
                    data: { 
                        labels: portfolio.map(s => s.sec), 
                        datasets: [{ 
                            data: initialData, 
                            backgroundColor: ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444', '#ec4899'], 
                            borderWidth: 0,
                            hoverOffset: 10
                        }] 
                    }, 
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        cutout: '75%', 
                        plugins: { 
                            legend: { position: 'bottom', labels: { color: '#9ca3af', boxWidth: 6, usePointStyle: true, font: {family: 'Inter', size: 10} } } 
                        } 
                    } 
                });
            }
        }

        // RENDER WATCHLIST
        function renderWatchlist(highlightIndex = -1) {
            const tbody = document.getElementById('watchlistBody');
            if (highlightIndex === -1) tbody.innerHTML = '';

            watchlist.forEach((item, index) => {
                let dayVarPct = item.price > 0 && item.prev > 0 ? ((item.price - item.prev) / item.prev) * 100 : 0;
                const dPrice = item.price > 0 ? item.price.toFixed(2) : '...';
                const dDay = item.price > 0 ? (dayVarPct > 0 ? '+' : '') + dayVarPct.toFixed(2) + "%" : '-';
                const cDay = dayVarPct >= 0 ? 'text-emerald-400' : 'text-red-400';

                if (highlightIndex === -1) {
                    const row = `
                        <tr id="wl-row-${index}" class="hover:bg-white/[0.03] border-b border-white/5 last:border-0 transition">
                            <td class="px-6 py-4"><div class="font-bold text-white text-sm">${item.name}</div><div class="text-[10px] text-gray-500 font-mono">${item.tick}</div></td>
                            <td class="px-6 py-4 text-xs text-blue-300/80 italic">${item.thesis}</td>
                            <td class="px-6 py-4 text-right text-white font-mono text-sm" id="wl-price-${index}">${dPrice}</td>
                            <td class="px-6 py-4 text-center font-mono font-bold text-sm ${cDay}" id="wl-day-${index}">${dDay}</td>
                            <td class="px-6 py-4 text-right"><span class="bg-yellow-500/10 text-yellow-500 px-2 py-1 rounded text-[10px] uppercase font-bold border border-yellow-500/20">Surveillance</span></td>
                        </tr>`;
                    tbody.innerHTML += row;
                } else if (index === highlightIndex) {
                    const row = document.getElementById(`wl-row-${index}`);
                    row.classList.add('flash-update'); setTimeout(() => row.classList.remove('flash-update'), 500);
                    document.getElementById(`wl-price-${index}`).innerText = dPrice;
                    document.getElementById(`wl-day-${index}`).innerText = dDay;
                    document.getElementById(`wl-day-${index}`).className = `px-6 py-4 text-center font-mono font-bold text-sm ${cDay}`;
                }
            });
        }

        // SEARCH
        let searchChartInstance = null;
        function fillSearch(t) { document.getElementById('mainTickerInput').value = t; searchTicker(); }
        
        async function searchTicker() {
            const t = document.getElementById('mainTickerInput').value.toUpperCase();
            if(!t) return;
            const card = document.getElementById('resultCard');
            card.classList.add('hidden');
            document.getElementById('searchLoader').style.display = 'block';
            
            const dataChart = await fetchPriceRobust(t);
            const dataQuote = await fetchFundamentalsQuote(t);

            document.getElementById('searchLoader').style.display = 'none';
            
            if(dataChart && dataChart.price) {
                const meta = dataChart.meta;
                const price = dataChart.price;
                const prev = dataChart.prev;
                
                document.getElementById('res-name').innerText = t; 
                document.getElementById('res-symbol').innerText = meta.symbol;
                document.getElementById('res-type').innerText = meta.instrumentType || "EQUITY";
                document.getElementById('res-exchange').innerText = meta.exchangeName;
                document.getElementById('res-price').innerText = price.toFixed(2);
                
                const perf = ((price - prev) / prev) * 100;
                const pEl = document.getElementById('res-perf'); 
                pEl.innerText = (perf > 0 ? '+' : '') + perf.toFixed(2) + " %"; 
                pEl.className = perf >= 0 ? "text-lg font-bold flex items-center justify-end gap-2 mt-1 text-emerald-400" : "text-lg font-bold flex items-center justify-end gap-2 mt-1 text-red-400";

                document.getElementById('res-open').innerText = (meta.regularMarketOpen||prev).toFixed(2);
                document.getElementById('res-range').innerText = (meta.regularMarketDayLow || "-") + " - " + (meta.regularMarketDayHigh || "-");
                let vol = meta.regularMarketVolume || 0; 
                document.getElementById('res-vol').innerText = vol > 1000000 ? (vol/1000000).toFixed(1) + "M" : (vol/1000).toFixed(1) + "K";

                if(dataQuote) {
                    const cap = dataQuote.marketCap || 0;
                    document.getElementById('res-cap').innerText = cap > 1000000000 ? (cap/1000000000).toFixed(2)+"B" : (cap/1000000).toFixed(2)+"M";
                    document.getElementById('res-pe').innerText = dataQuote.trailingPE ? dataQuote.trailingPE.toFixed(2) : "-";
                    document.getElementById('res-eps').innerText = dataQuote.epsTrailingTwelveMonths ? dataQuote.epsTrailingTwelveMonths.toFixed(2) : "-";
                    document.getElementById('res-beta').innerText = dataQuote.beta ? dataQuote.beta.toFixed(2) : "-";
                    const rating = dataQuote.averageAnalystRating || "-";
                    document.getElementById('res-rating').innerText = rating.replace("-", " ").toUpperCase();
                }

                if(dataChart.timestamps && dataChart.quotes) {
                    const ctx = document.getElementById('searchChart').getContext('2d');
                    if(searchChartInstance) searchChartInstance.destroy();
                    const isGreen = price >= prev;
                    const lineColor = isGreen ? '#34d399' : '#f87171';
                    
                    // Gradient Fill
                    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                    gradient.addColorStop(0, isGreen ? 'rgba(52, 211, 153, 0.2)' : 'rgba(248, 113, 113, 0.2)');
                    gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');

                    const clean = dataChart.quotes.map((q,i)=>({t:dataChart.timestamps[i],y:q})).filter(p=>p.y!==null);

                    searchChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: clean.map(p => new Date(p.t * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })),
                            datasets: [{ 
                                data: clean.map(p => p.y), 
                                borderColor: lineColor, 
                                backgroundColor: gradient, 
                                borderWidth: 2, 
                                fill: true, 
                                pointRadius: 0, 
                                tension: 0.2 
                            }]
                        },
                        options: { 
                            responsive: true, 
                            maintainAspectRatio: false, 
                            plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } }, 
                            scales: { 
                                x: { display: false }, 
                                y: { position: 'right', grid: { color: '#333' } } 
                            },
                            interaction: { mode: 'nearest', axis: 'x', intersect: false }
                        }
                    });
                }
                card.classList.remove('hidden');
            } else { alert("Ticker introuvable"); }
        }

        // SIMU
        let simChartInstance = null;
        function calculateSim() { 
            const start=parseFloat(document.getElementById('sim-start').value), monthly=parseFloat(document.getElementById('sim-monthly').value), rate=parseFloat(document.getElementById('sim-rate').value)/100, years=parseInt(document.getElementById('sim-years').value);
            let capital=start, totalInvested=start, labels=[], dataCapital=[], dataInvested=[];
            for(let i=0;i<=years;i++){
                labels.push("An "+i); dataCapital.push(capital); dataInvested.push(totalInvested);
                if(i<years){ for(let m=0;m<12;m++){ capital+=monthly; capital*=(1+rate/12); totalInvested+=monthly; } }
            }
            document.getElementById('sim-result').innerText=Math.round(dataCapital[dataCapital.length-1]).toLocaleString()+" ‚Ç¨";
            
            const ctx=document.getElementById('simChart').getContext('2d');
            if(simChartInstance) simChartInstance.destroy();

            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(59, 130, 246, 0.3)');
            gradient.addColorStop(1, 'rgba(59, 130, 246, 0)');

            simChartInstance = new Chart(ctx,{
                type:'line',
                data:{
                    labels,
                    datasets:[
                        {
                            label:'Patrimoine Compos√©',
                            data:dataCapital,
                            borderColor:'#3b82f6',
                            backgroundColor: gradient,
                            fill:true,
                            tension:0.4,
                            pointRadius: 0,
                            pointHoverRadius: 6
                        },
                        {
                            label:'Capital Investi',
                            data:dataInvested,
                            borderColor:'#52525b',
                            borderDash:[5,5],
                            tension:0.4,
                            pointRadius:0
                        }
                    ]
                },
                options:{
                    responsive:true,
                    maintainAspectRatio:false,
                    scales:{
                        x:{grid:{display:false, color: '#333'}, ticks: {color: '#666'}},
                        y:{grid:{color:'#1e293b'}, ticks: {color: '#666'}}
                    },
                    plugins:{
                        legend:{labels:{color:'#94a3b8', font:{family:'Inter'}}},
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: 'rgba(255,255,255,0.1)',
                            borderWidth: 1
                        }
                    }
                }
            });
        }

        function initApp() {
            calculateSim(); 
            renderDashboard(); 
            setTimeout(startLiveFeed, 1000); 
            setInterval(startLiveFeed, 120000); 
        }
    </script>
</body>
</html>
