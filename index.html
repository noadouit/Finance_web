<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOUIT CAPITAL | Terminal v1.9.0</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { 
                        dark: '#050505', panel: '#0f1115', 
                        accent: '#3b82f6', success: '#10b981', danger: '#ef4444', 
                        gold: '#fbbf24', copper: '#b87333' 
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: #e4e4e7; overflow-x: hidden; }
        .bg-grid { background-size: 40px 40px; background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px); mask-image: radial-gradient(circle at center, black 40%, transparent 100%); }
        .glass-panel { background: rgba(15, 17, 21, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        
        .gold-text-shimmer { background: linear-gradient(to right, #e4e4e7 0%, #fbbf24 50%, #e4e4e7 100%); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: goldShimmer 3s linear infinite alternate; font-weight: 800; letter-spacing: -0.02em; }
        @keyframes goldShimmer { 0% { background-position: 0% center; } 100% { background-position: 100% center; } }

        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }

        .reveal-app { animation: revealApp 0.8s forwards cubic-bezier(0.22, 1, 0.36, 1); opacity: 0; }
        @keyframes revealApp { 0% { opacity: 0; transform: scale(0.98); } 100% { opacity: 1; transform: scale(1); } }
        
        .thesis-btn { padding: 12px 24px; border-radius: 10px; font-weight: 800; font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; transition: all 0.3s; opacity: 0.6; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); }
        .thesis-btn.active { opacity: 1; transform: translateY(-2px); }
        .thesis-btn-bear.active { background: rgba(239,68,68,0.1); border-color: #ef4444; color: #ef4444; }
        .thesis-btn-bull.active { background: rgba(184,115,51,0.1); border-color: #b87333; color: #b87333; }

        .tab-content { display: none; width: 100%; } .tab-content.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .nav-btn { padding: 8px 18px; font-size: 12px; font-weight: 600; border-radius: 10px; transition: all 0.3s; color: #71717a; }
        .nav-btn.active { background: #fff; color: #000; }
        
        .ticker-wrap { position: fixed; bottom: 0; width: 100%; height: 40px; background-color: #0f1115; border-top: 1px solid rgba(255, 255, 255, 0.1); z-index: 9000; overflow: hidden; display: flex; align-items: center; }
        .ticker-content { display: inline-block; white-space: nowrap; padding-left: 100%; animation: ticker 45s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 2rem; font-family: 'JetBrains Mono', monospace; font-size: 11px; color: #9ca3af; text-transform: uppercase; }

        .legal-modal { animation: modalPop 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; } 
        @keyframes modalPop { 0% { opacity: 0; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
    </style>
</head>

<body class="antialiased min-h-screen flex flex-col selection:bg-blue-500/30 selection:text-blue-200">

    <div id="legal-modal" class="fixed inset-0 z-[10001] hidden flex items-center justify-center backdrop-blur-md bg-black/60">
        <div class="legal-modal w-full max-w-lg glass-panel p-8 rounded-3xl border border-white/10 m-4 relative text-center">
            <div class="w-12 h-12 rounded-full bg-blue-900/20 text-blue-400 flex items-center justify-center mx-auto mb-4 text-2xl border border-blue-500/20">‚öñÔ∏è</div>
            <h2 class="text-2xl font-black text-white uppercase tracking-tight">Disclaimer Compliance</h2>
            <p class="text-[10px] text-gray-500 font-mono mt-1 uppercase mb-6">Cadre √âducatif & Informatif</p>
            <div class="text-xs text-gray-400 leading-relaxed space-y-4 text-justify mb-8 h-40 overflow-y-auto pr-2 custom-scroll">
                <p><strong>¬© 2025 Douit Capital.</strong> Cette interface est un projet de d√©monstration analytique pour le Master.</p>
                <p class="text-white font-bold bg-red-500/10 p-3 rounded border border-red-500/20">‚ö†Ô∏è AVERTISSEMENT : Les analyses pr√©sent√©es ne constituent en aucun cas un conseil en investissement ou une incitation √† op√©rer sur les march√©s financiers.</p>
                <p>Les performances pass√©es ne pr√©jugent pas des performances futures. L'utilisateur est seul responsable de ses d√©cisions financi√®res.</p>
            </div>
            <button onclick="toggleLegal(false)" class="w-full py-4 rounded-xl bg-blue-600 hover:bg-blue-500 text-white font-bold text-xs uppercase tracking-widest transition shadow-lg">Confirmer & Acc√©der</button>
        </div>
    </div>

    <div id="login-screen" class="fixed inset-0 z-[9990] bg-dark flex flex-col justify-center items-center">
        <div class="absolute inset-0 bg-grid opacity-30"></div>
        <div class="login-box w-full max-w-sm p-10 glass-panel rounded-3xl relative z-10 text-center border border-white/5">
            <h1 class="text-3xl font-black text-white mb-1 tracking-tighter">DOUIT CAPITAL</h1>
            <p class="text-[10px] font-mono text-gray-500 mb-8 uppercase tracking-[0.2em]">Asset Management Terminal</p>
            <div class="relative group">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl blur opacity-20 group-hover:opacity-40 transition duration-500"></div>
                <input type="password" id="passwordInput" class="relative w-full bg-black border border-white/10 text-white text-center tracking-[0.5em] rounded-xl p-4 outline-none focus:border-blue-500 transition font-mono" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeypress="if(event.key === 'Enter') checkLogin()">
            </div>
            <button onclick="checkLogin()" class="mt-6 w-full py-4 rounded-xl bg-white text-black font-bold text-xs uppercase tracking-widest hover:bg-gray-200 transition relative z-20 cursor-pointer">Login</button>
            <p id="loginError" class="text-red-500 text-xs mt-4 hidden font-mono">:: IDENTIFIANT INCORRECT ::</p>
        </div>
    </div>

    <div id="app-container" style="display: none;" class="flex-1 flex flex-col w-full h-full relative pb-10">
        <div class="fixed inset-0 bg-grid opacity-20 pointer-events-none z-0"></div>
        
        <nav class="glass-panel sticky top-6 z-50 h-16 mx-6 md:ml-20 rounded-2xl border border-white/10 shadow-2xl flex items-center justify-between px-6">
            <div class="flex items-center gap-3 cursor-pointer" onclick="switchTab('home')">
                <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center text-black font-black text-lg">D</div>
                <span class="text-sm gold-text-shimmer tracking-tight hidden md:block">Douit Capital</span>
            </div>
            <div class="flex space-x-1 bg-black/50 p-1.5 rounded-xl border border-white/5 backdrop-blur-md overflow-x-auto">
                <button onclick="switchTab('home')" id="btn-home" class="nav-btn">Terminal</button>
                <button onclick="switchTab('convictions')" id="btn-convictions" class="nav-btn">Th√®se</button>
                <button onclick="switchTab('dashboard')" id="btn-dashboard" class="nav-btn">Portefeuille</button>
                <button onclick="switchTab('watchlist')" id="btn-watchlist" class="nav-btn">Radar</button>
                <button onclick="switchTab('simulation')" id="btn-simulation" class="nav-btn">Projection</button>
            </div>
        </nav>

        <main class="flex-1 w-full relative z-10 p-6">
            <div id="home" class="tab-content active">
                <div class="flex flex-col items-center justify-center min-h-[60vh] text-center px-4">
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-blue-500/30 bg-blue-900/10 text-blue-400 text-xs font-mono mb-6">Market Intelligence Active</div>
                    <h1 class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-b from-white to-gray-600 mb-8 tracking-tighter">Market Insight.</h1>
                    <div class="w-full max-w-xl relative group">
                        <input type="text" id="mainTickerInput" class="relative w-full bg-black/80 border border-white/10 text-white text-xl px-6 py-5 rounded-xl focus:border-blue-500 transition outline-none" placeholder="Rechercher un actif..." onkeypress="if(event.key === 'Enter') searchTicker()">
                    </div>
                    <div id="searchLoader" class="hidden mt-8 border-2 border-white/10 border-t-blue-500 w-8 h-8 rounded-full animate-spin"></div>
                    <div id="resultCard" class="hidden w-full max-w-4xl mt-8 glass-panel rounded-2xl p-6 text-left border border-white/10 animate-in fade-in slide-in-from-bottom-4">
                        <div class="flex justify-between items-start mb-6"><div><h2 id="res-name" class="text-3xl font-bold text-white">Name</h2><p id="res-symbol" class="text-blue-400 font-mono text-sm">TICKER</p></div><div class="text-right"><div id="res-price" class="text-4xl font-mono font-bold text-white">--</div><div id="res-perf" class="text-lg font-bold">--%</div></div></div>
                        <div class="h-[300px] w-full bg-black/20 rounded-xl relative"><canvas id="searchChart"></canvas></div>
                    </div>
                </div>
            </div>

            <div id="convictions" class="tab-content max-w-7xl mx-auto">
                <div class="flex justify-center gap-6 mb-12">
                    <button onclick="switchThesis('bear')" id="btn-thesis-bear" class="thesis-btn thesis-btn-bear active">üìâ The Short (Anti-Tech)</button>
                    <button onclick="switchThesis('bull')" id="btn-thesis-bull" class="thesis-btn thesis-btn-bull">üêÇ The Long (Real Assets)</button>
                </div>

                <div id="thesis-bear" class="thesis-section animate-in fade-in duration-500">
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div class="lg:col-span-7 space-y-8">
                            <div class="glass-panel p-8 rounded-3xl border border-red-500/20 bg-gradient-to-br from-red-900/10 to-transparent">
                                <h2 class="text-3xl font-black text-white mb-6">L'Illusion Schump√©t√©rienne</h2>
                                <div class="text-gray-400 leading-relaxed text-justify space-y-4 custom-scroll max-h-[450px] overflow-y-auto pr-4 text-sm">
                                    <p class="text-white font-bold">1. La Fin de la Croissance R√©elle :</p>
                                    <p>Joseph Schumpeter a d√©fini l'innovation comme un moteur de "Destruction Cr√©atrice". Aujourd'hui, nous observons une saturation : l'innovation marginale de la Big Tech se concentre sur l'optimisation publicitaire et la r√©tention d'attention plut√¥t que sur des gains de productivit√© massifs pour l'√©conomie r√©elle.</p>
                                    <p class="text-white font-bold">2. Le Pi√®ge des Multiples (PSR/PER) :</p>
                                    <p>Avec des Price-to-Sales (PSR) d√©passant 40x pour certains leaders de l'IA, le march√© valorise une perfection math√©matique sur 20 ans. Historiquement, aucun cycle n'a surv√©cu √† une telle d√©connexion entre le CAPEX (investissements massifs en puces) et le Revenue marginal r√©el g√©n√©r√© par les clients finaux.</p>
                                    <p class="text-white font-bold">3. L'Impasse de l'√âconomie Circulaire :</p>
                                    <p>Le mod√®le "Software" externalise ses co√ªts physiques. L'arriv√©e imminente de r√©gulations for√ßant le "True Cost Accounting" (co√ªt carbone des Data Centers, recyclage du silicium) va comprimer des marges de 80% vers des niveaux industriels standards.</p>
                                </div>
                            </div>
                        </div>
                        <div class="lg:col-span-5"><div class="glass-panel p-6 rounded-3xl border border-white/5 h-full flex flex-col"><h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Tech vs History (PSR)</h3><div class="flex-1"><canvas id="techBubbleChart"></canvas></div><p class="text-[10px] text-red-400 mt-4 font-bold tracking-tighter">NIVEAU D'ALERTE : MAXIMAL</p></div></div>
                    </div>
                </div>

                <div id="thesis-bull" class="thesis-section hidden animate-in fade-in duration-500">
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div class="lg:col-span-7 space-y-8">
                            <div class="glass-panel p-8 rounded-3xl border border-orange-500/20 bg-gradient-to-br from-orange-900/10 to-transparent">
                                <h2 class="text-3xl font-black text-white mb-6">Le Choc d'Offre Ricardien</h2>
                                <div class="text-gray-300 leading-relaxed text-justify space-y-4 custom-scroll max-h-[450px] overflow-y-auto pr-4 text-sm">
                                    <p class="text-white font-bold">1. Rente de Raret√© et Co√ªt Marginal :</p>
                                    <p>La th√©orie de David Ricardo sur la rente diff√©rentielle s'applique parfaitement au cuivre. Le prix du march√© est fix√© par le co√ªt de production de la mine la moins rentable n√©cessaire pour satisfaire la demande. Or, les mines √† haute teneur (grades > 1%) s'√©puisent.</p>
                                    <p class="text-white font-bold">2. L'Inflation G√©ologique :</p>
                                    <p>Depuis 2000, la teneur moyenne du minerai est pass√©e de 1.2% √† 0.5%. Extraire la m√™me tonne de cuivre demande aujourd'hui 2x plus d'√©nergie, 3x plus d'eau et g√©n√®re 2x plus de d√©chets. Le prix "plancher" doit m√©caniquement monter pour maintenir l'incitation √† produire.</p>
                                    <p class="text-white font-bold">3. Le Mur du CAPEX :</p>
                                    <p>Il faut en moyenne 16.5 ans entre la d√©couverte d'un gisement et la premi√®re tonne produite. Le sous-investissement massif depuis 2014 cr√©e un tunnel de p√©nurie in√©lastique qui ne peut √™tre r√©solu √† court terme, quel que soit le prix.</p>
                                </div>
                            </div>
                        </div>
                        <div class="lg:col-span-5"><div class="glass-panel p-6 rounded-3xl border border-white/5 h-full flex flex-col"><h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Supply Cliff (Cuivre)</h3><div class="flex-1"><canvas id="copperSupplyChart"></canvas></div><p class="text-[10px] text-orange-400 mt-4 font-bold tracking-tighter">D√âFICIT STRUCTUREL : 6.5MT (2030)</p></div></div>
                    </div>
                </div>
            </div>

            <div id="dashboard" class="tab-content max-w-7xl mx-auto p-6"><div class="flex justify-between items-end mb-8"><h1 class="text-3xl font-bold text-white">Portefeuille Global</h1><div class="text-right"><div class="text-xs text-gray-500 uppercase">Total AUM</div><div class="text-4xl font-mono font-bold text-white" id="totalVal">-- ‚Ç¨</div></div></div><div class="grid grid-cols-1 lg:grid-cols-3 gap-8"><div class="lg:col-span-2 glass-panel rounded-2xl border border-white/5 overflow-hidden"><table class="w-full text-left text-sm text-gray-400"><thead class="bg-white/5 uppercase text-[10px] font-bold text-gray-500"><tr><th class="px-6 py-4">Actif</th><th class="px-6 py-4 text-right">Qt√©</th><th class="px-6 py-4 text-right">Prix</th><th class="px-6 py-4 text-right">Perf</th></tr></thead><tbody class="divide-y divide-white/5" id="tableBody"></tbody></table></div><div class="glass-panel rounded-2xl p-6 border border-white/5 flex flex-col"><div class="mb-6"><h3 class="text-xs font-bold text-gray-500 uppercase mb-2 tracking-widest">Macro Live</h3><div class="flex justify-between text-sm text-gray-400 border-b border-white/5 pb-1 mb-1"><span>üá∫üá∏ Fed Rate</span><span class="text-white">5.50%</span></div><div class="flex justify-between text-sm text-gray-400 border-b border-white/5 pb-1"><span>üá™üá∫ ECB Rate</span><span class="text-white">4.00%</span></div></div><h3 class="text-xs font-bold text-white uppercase mb-4 tracking-widest">Allocation</h3><div class="flex-1 relative min-h-[200px]"><canvas id="sectorChart"></canvas></div></div></div></div>
            
            <div id="watchlist" class="tab-content max-w-5xl mx-auto p-8"><h1 class="text-3xl font-bold text-white mb-6">Watchlist</h1><div class="glass-panel rounded-2xl border border-white/5 overflow-hidden"><table class="w-full text-left text-sm text-gray-400"><thead class="bg-white/5 uppercase text-[10px] font-bold text-gray-500"><tr><th class="px-6 py-4">Cible</th><th class="px-6 py-4">Th√®se</th><th class="px-6 py-4 text-right">Prix</th></tr></thead><tbody class="divide-y divide-white/5" id="watchlistBody"></tbody></table></div></div>
            <div id="simulation" class="tab-content max-w-4xl mx-auto p-8 text-center"><h1 class="text-3xl font-bold text-white mb-8">Projection de Patrimoine</h1><div class="glass-panel p-6 rounded-2xl border border-white/5 mb-6 grid grid-cols-3 gap-4"><input type="number" id="sim-start" value="10000" class="bg-black/50 p-3 rounded-lg text-white border border-white/10" placeholder="Capital"><input type="number" id="sim-monthly" value="500" class="bg-black/50 p-3 rounded-lg text-white border border-white/10" placeholder="Mensuel"><button onclick="calculateSim()" class="bg-blue-600 text-white font-bold rounded-lg">Simuler</button></div><h2 class="text-5xl font-mono font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-green-400 mb-6" id="sim-result">-- ‚Ç¨</h2><div class="h-[300px] w-full"><canvas id="simChart"></canvas></div></div>
        </main>

        <div class="ticker-wrap"><div class="ticker-content" id="news-ticker-content"></div></div>
    </div>
    
    <script>
        const PASSWORD_CONFIG = "admin"; 
        let portfolio = [{ tick: "AI.PA", name: "Air Liquide", sec: "Chimie", q: 20, pru: 171.18 }, { tick: "SU.PA", name: "Schneider Electric", sec: "Industrie", q: 10, pru: 236.99 }, { tick: "TTE.PA", name: "TotalEnergies", sec: "Energie", q: 38, pru: 56.97 }, { tick: "AIR.PA", name: "Airbus", sec: "A√©ro.", q: 5, pru: 212.46 }, { tick: "SGO.PA", name: "Saint-Gobain", sec: "Construct.", q: 7, pru: 88.15 }, { tick: "BRES.PA", name: "ETF Basic Res.", sec: "Mat√©riaux", q: 6, pru: 104.84 }];
        let watchlist = [{ tick: "CJ1.PA", name: "Japan MSCI", thesis: "Yen Rebound" }, { tick: "AEEM.PA", name: "Emerging Markets", thesis: "Cycle Low" }, { tick: "FCX", name: "Freeport-McMoRan", thesis: "Copper Pure Player" }];

        function checkLogin() {
            const input = document.getElementById('passwordInput');
            if (!input || input.value.trim() !== PASSWORD_CONFIG) { document.getElementById('loginError').classList.remove('hidden'); input.value = ''; return; }
            document.getElementById('login-screen').style.display = 'none';
            initApp();
            document.getElementById('app-container').style.display = 'flex';
            document.getElementById('app-container').classList.add('reveal-app');
            toggleLegal(true);
        }

        function switchThesis(type) {
            document.querySelectorAll('.thesis-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-thesis-' + type).classList.add('active');
            document.querySelectorAll('.thesis-section').forEach(s => s.classList.add('hidden'));
            document.getElementById('thesis-' + type).classList.remove('hidden');
            if(type === 'bear') renderTechBubbleChart();
            if(type === 'bull') renderCopperChart();
        }

        function renderTechBubbleChart() {
            const ctx = document.getElementById('techBubbleChart'); if(!ctx) return;
            if(window.techChartInstance) window.techChartInstance.destroy();
            window.techChartInstance = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: { labels: ['1998', '1999', '2000', '2001', '...', '2022', '2023', '2024'], datasets: [{ label: 'Cisco 2000 (PSR)', data: [10, 40, 100, 30, null, null, null, null], borderColor: '#6b7280', borderDash: [5,5], tension: 0.4 }, { label: 'Nvidia 2024 (PSR)', data: [null, null, null, null, 20, 120, 450, 950], borderColor: '#ef4444', borderWidth: 3, tension: 0.4 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#9ca3af', font: { size: 10 } } } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
            });
        }

        function renderCopperChart() {
            const ctx = document.getElementById('copperSupplyChart'); if(!ctx) return;
            if(window.copperChartInstance) window.copperChartInstance.destroy();
            window.copperChartInstance = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: { labels: ['2020', '2024', '2028', '2032'], datasets: [{ label: 'Demande', data: [25, 30, 39, 52], borderColor: '#10b981', borderWidth: 3 }, { label: 'Offre Mini√®re', data: [25, 26.5, 25, 23], borderColor: '#ef4444', borderWidth: 2, borderDash: [5,5] }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#9ca3af', font: { size: 10 } } } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
            });
        }

        function toggleLegal(show) { const modal = document.getElementById('legal-modal'); if(show) modal.classList.remove('hidden'); else modal.classList.add('hidden'); }
        function startNewsTicker() { const c = document.getElementById('news-ticker-content'); if (!c) return; const n = [{ t: "MACIF ANALYST: RATIO CLAIMS/REVENUE STABLE ON PRO PORTFOLIO", y: "u" }, { t: "ALERT: COPPER DEFICIT ACCELERATES AS PERMIT DELAYS HIT 16 YEARS", y: "u" }, { t: "MARKET: TECH VALUATIONS REACH HISTORIC Z-SCORE EXTREMES", y: "d" }]; let h = ""; n.forEach(i => { const now=new Date();const m=Math.floor(Math.random()*59);const ts=`${now.getHours()}:${m<10?'0'+m:m}`; let cl="text-gray-400"; if(i.y==="u")cl="text-green-500 font-bold";if(i.y==="d")cl="text-red-500 font-bold"; h+=`<div class="ticker-item"><span class="text-gray-600 mr-2">[${ts}]</span><span class="${cl}">${i.t}</span></div>`; }); c.innerHTML = h; }
        
        function switchTab(id) { 
            document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active')); document.getElementById(id).classList.add('active'); 
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); document.getElementById('btn-' + id).classList.add('active'); 
            if(id==='simulation') calculateSim(); 
            if(id==='watchlist') updateWatchlist(); 
            if(id==='convictions') switchThesis('bear');
        }

        async function fetchPriceRobust(t){ const p="https://corsproxy.io/?",u=`https://query1.finance.yahoo.com/v8/finance/chart/${t}?interval=1d&range=5d&t=${Date.now()}`; try{const r=await fetch(p+encodeURIComponent(u));if(!r.ok)throw new Error;const j=await r.json(),res=j.chart.result[0];return{price:res.meta.regularMarketPrice,prev:res.meta.chartPreviousClose,quotes:res.indicators.quote[0].close,timestamps:res.timestamp};}catch(e){return null;}}
        async function updatePortfolio(){ let tv=0; const tb=document.getElementById('tableBody'); if(!tb)return; tb.innerHTML=''; for(let s of portfolio){ const d=await fetchPriceRobust(s.tick); if(d){s.price=d.price;s.prev=d.prev;} const v=s.price*s.q; tv+=v; const p=((s.price-s.pru)/s.pru)*100; tb.innerHTML+=`<tr class="hover:bg-white/5 border-b border-white/5"><td class="px-6 py-4"><div class="text-white font-bold">${s.name}</div><div class="text-[10px] text-gray-500">${s.tick}</div></td><td class="px-6 py-4 text-right font-mono text-gray-400">${s.q}</td><td class="px-6 py-4 text-right font-mono text-white">${s.price.toFixed(2)} ‚Ç¨</td><td class="px-6 py-4 text-right font-mono font-bold ${p>=0?'text-green-400':'text-red-400'}">${(p>0?'+':'')+p.toFixed(2)}%</td></tr>`; } document.getElementById('totalVal').innerText=Math.round(tv).toLocaleString()+" ‚Ç¨"; renderSectorChart(); }
        function renderSectorChart(){ const ctxEl=document.getElementById('sectorChart'); if(!ctxEl)return; const ctx=ctxEl.getContext('2d'); if(window.mySectorChart)window.mySectorChart.destroy(); window.mySectorChart=new Chart(ctx,{type:'doughnut',data:{labels:portfolio.map(s=>s.sec),datasets:[{data:portfolio.map(s=>s.price*s.q),backgroundColor:['#3b82f6','#10b981','#ef4444','#f59e0b','#8b5cf6','#64748b'],borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,cutout:'70%',plugins:{legend:{position:'bottom',labels:{color:'#9ca3af',usePointStyle:true,font:{size:9}}}}}}); }
        async function updateWatchlist(){ const tb=document.getElementById('watchlistBody'); if(!tb)return; tb.innerHTML=''; for(let i of watchlist){ const d=await fetchPriceRobust(i.tick); const p=d?d.price.toFixed(2):"..."; tb.innerHTML+=`<tr class="hover:bg-white/5 border-b border-white/5"><td class="px-6 py-4 font-bold text-white">${i.name} <span class="text-xs font-normal text-gray-500 block">${i.tick}</span></td><td class="px-6 py-4 text-xs text-blue-300 italic">${i.thesis}</td><td class="px-6 py-4 text-right font-mono text-white">${p}</td></tr>`; } }
        let searchChartInstance=null; async function searchTicker(){ const t=document.getElementById('mainTickerInput').value.toUpperCase(); if(!t)return; document.getElementById('searchLoader').classList.remove('hidden'); document.getElementById('resultCard').classList.add('hidden'); const d=await fetchPriceRobust(t); document.getElementById('searchLoader').classList.add('hidden'); if(d){ document.getElementById('resultCard').classList.remove('hidden'); document.getElementById('res-name').innerText=t; document.getElementById('res-symbol').innerText=t; document.getElementById('res-price').innerText=d.price.toFixed(2); const p=((d.price-d.prev)/d.prev)*100; document.getElementById('res-perf').innerText=(p>0?'+':'')+p.toFixed(2)+"%"; document.getElementById('res-perf').className=`text-lg font-bold ${p>=0?'text-green-400':'text-red-400'}`; const ctx=document.getElementById('searchChart').getContext('2d'); if(searchChartInstance)searchChartInstance.destroy(); searchChartInstance=new Chart(ctx,{type:'line',data:{labels:d.timestamps.map(t=>new Date(t*1000).getHours()+'h'),datasets:[{data:d.quotes,borderColor:p>=0?'#10b981':'#ef4444',backgroundColor:p>=0?'rgba(16,185,129,0.1)':'rgba(239,68,68,0.1)',fill:true,pointRadius:0,tension:0.3}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{display:false},y:{grid:{color:'#333'}}}}}); } }
        function calculateSim(){ const s=parseFloat(document.getElementById('sim-start').value),m=parseFloat(document.getElementById('sim-monthly').value); let l=[],d=[],c=s; for(let i=0; i<=20; i++){ l.push("An "+i); d.push(c); if(i<20){for(let j=0; j<12; j++){c+=m; c*=(1+0.08/12);}}} document.getElementById('sim-result').innerText=Math.round(d[d.length-1]).toLocaleString()+" ‚Ç¨"; const ctx=document.getElementById('simChart').getContext('2d'); if(window.simChart)window.simChart.destroy(); window.simChart=new Chart(ctx,{type:'line',data:{labels:l,datasets:[{label:'Capital',data:d,borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,0.2)',fill:true}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{grid:{color:'#333'}},x:{grid:{display:false}}},plugins:{legend:{display:false}}}}); }
        function initApp(){ updatePortfolio(); startNewsTicker(); setInterval(updatePortfolio,60000); }
    </script>
</body>
</html>
